# Tutorial: Deleting a Task in the To-Do App

This tutorial extends the "Building a To-Do List App" tutorial by adding the functionality to delete a task. It demonstrates how a new capability can be seamlessly and securely integrated using the existing Butterfly Paradigm.

## 1. The Goal

We will create a new function, `deleteTask(userId, taskId)`, which allows a user to delete one of their specific to-do items.

As with other functions, the application code will remain completely decoupled from the database. It will simply request the *capability* to delete a task by using a known `z`-address.

---

## 2. Step 1: Defining the New Resource

First, as data administrators, we must define a new resource template in the persistent log. This definition represents the "delete" capability and is assigned a unique, known `z`-address.

**Resource at `z-address: 203`**
*   **Description:** The capability to delete a single task, provided the user is the owner.
*   **Connection Details:** `{ protocol: 'sql', address: 'todo_database.db' }`
*   **Required Permission:** `{ action: 'delete', resourceType: 'task', condition: 'isOwner' }`

This definition is registered once. The application developer is now informed: "To delete a task, use `z=203`."

---

## 3. Step 2: Building the Application Logic

Next, we add the `deleteTask` function to our application code. The application already has access to an initialized `QubeResolver` instance.

```javascript
// --- ToDoApp.js ---

// Assume 'qubeResolver' is initialized and available.

/**
 * Deletes a specific task for a given user.
 * @param {string} userId - The ID of the user deleting the task.
 * @param {string} taskId - The ID of the task to be deleted.
 */
async function deleteTask(userId, taskId) {
  // 1. Define the coordinate: the z-address and the security context.
  const z_address = 203; // The known address for deleting a task.
  const securityContext = {
    id: userId,
    permissions: [{ action: 'delete', resourceType: 'task', condition: 'isOwner' }]
  };

  // 2. Resolve the coordinate to get an active Qube.
  // The resolver will fetch the definition at z=203 and verify that the user
  // in the context has 'delete' permissions for tasks they own.
  const resolvedQube = await qubeResolver.resolve(z_address, securityContext);

  if (!resolvedQube) {
    console.error(`Access denied for user ${userId} to delete task ${taskId}.`);
    return false;
  }

  // 3. Invoke the 'delete' capability of the Qube.
  // Based on the resolved permissions, the Qube now has a 'delete' method.
  // The Qube itself handles the database DELETE statement.
  console.log(`User ${userId} authorized. Deleting task ${taskId}...`);
  const success = await resolvedQube.delete({ ownerId: userId, id: taskId });

  return success;
}
```

---

## 4. Analysis: Consistent and Secure Extension

This new feature perfectly aligns with the principles of the Butterfly Paradigm:

*   **Predictable Design:** Adding a new feature follows the exact same pattern as creating the first ones: define the resource, get its `z`-address, and resolve it. The developer workflow is simple and repeatable.

*   **Capability-Based API:** The `resolvedQube` is an active object whose API is determined by the permissions granted. The `.delete()` method only exists on the `resolvedQube` because the `QubeResolver` verified the user's `delete` permission for this specific request. The application cannot call a method for which it was not authorized.

*   **Zero Impact on Decoupling:** The application code is still completely ignorant of the underlying database. The `deleteTask` function doesn't know if it's triggering a SQL `DELETE` command, a NoSQL document removal, or an API call. This makes the system incredibly flexible and easy to maintain.

By following this pattern, we can continue to add complex features to our application without increasing the complexity of the application code itself or compromising on security.

```

<!--
[PROMPT_SUGGESTION]How would the `QubeResolver` and `ResolvedQube` be implemented for the To-Do app tutorials?[/PROMPT_SUGGESTION]
[PROMPT_SUGGESTION]Based on all the tutorials, create a single `ToDoApp.js` file that includes get, add, delete, and search functionality.[/PROMPT_SUGGESTION]
->
Generated by Gemini 2.5 Pro
Prompts to try
